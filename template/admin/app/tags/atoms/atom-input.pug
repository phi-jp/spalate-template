atom-input-text
  label
    div.fs12.text-gray.mb8 {opts.option.label}
    input.input.w-full(ref='v', type='{opts.item.input_type || "text"}', placeholder='{opts.item.placeholder}', value='{opts._value}', required='{opts.item.required}', readonly='{opts.item.readonly}')

  script.
    this.on('mount', () => {
    });
    this.getValue = () => {
      return this.refs.v.value;
    };

atom-input-multitext
  label
    div.fs12.text-gray.mb8 {opts.option.label}
    textarea.input.w-full.mb8(ref='v', rows='8') {opts._value}
    //- div.f.fm.fs10.text-weak
    //-   span 文字数：
    //-   span {getWordCount()}
  script.
    this.getValue = () => {
      return this.refs.v.value;
    };

atom-input-image
  label
    div.fs12.text-gray.mb8 {opts.option.label}
    div(onclick='{click}')
      img(src='{url}')
  
  script.
    this.on('mount', () => {
      this.url = this.opts._value || 'https://dummyimage.com/600x400/000/fff';
      this.update();

      var input = document.createElement('input');
      input.type = 'file';
      input.setAttribute('accept', 'image/*');
      input.onchange = async (e) => {
        var f = e.target.files[0];
        if (!f) return ;

        var base64 = await this.fileToBase64(f);
        this.url = base64;
        this.update();
      };

      this.imageInput = input;
    });

    this.click = () => {
      this.imageInput.click();
    };

    this.upload = async (file) => {
      this.url = await admin.method.upload(file);
      this.update();
    };

    this.getValue = () => {
      return this.url;
    };

    this.fileToBase64 = (file) => {
      return new Promise((resolve) => {
        var fr = new FileReader();
        fr.onload = (e) => {
          resolve(e.target.result);
        };

        fr.readAsDataURL(file);
      })
    };

atom-input-multiform
  div.fs12.text-gray.mb8 {opts.option.label}
  div
    div.f.fm.mb8.cursor-pointer(each='{item, index in items}', onclick='{editItem}')
      div.mr4 {index}. 
      div.border.p8
        p(each='{value in item}') 
          span {opts.option.forms[index].label}: {value}
          br
    div(onclick='{createItem}')
      button.button.primary(type='button') 追加

  script.
    var self = this;

    this.on('mount', () => {
      this.key = opts.option.key;
      this.items = opts._value || [];
      this.update();
    });

    this.createItem = (e) => {
      // モーダルを開く
      var modal = spat.modal.open('modal-edit', {
        label: self.opts.option.label, // ラベル
        forms: self.opts.option.forms, // 生成したいフォームを渡す（schemaと同じ）
        readonly: self.opts.option.readonly,
      });

      modal.on('submit', (e) => {
        var item = e.item;
        this.items.push(item);

        this.update();
      });
    };

    this.editItem = (e) => {
      var item = e.item.item;
      var index = e.item.index;
      var item_id = this.items[index].id;

      // モーダルを作成
      var modal = spat.modal.open('modal-edit', {
        label: self.opts.option.label, // ラベル
        forms: self.opts.option.forms, // 生成したいフォームを渡す（schemaと同じ）
        item: item, // 編集したい場合は ここにメニューを渡す
      });

      // 更新
      modal.on('submit', (event) => {
        var item = event.item;
        this.items[index] = item;

        this.update();
      });
      
      // 削除
      modal.on('del', (event) => {
        this.items.splice(index, 1);
        this.update();
      });
    };

    this.getValue = () => {
      return this.items || null;
    };
